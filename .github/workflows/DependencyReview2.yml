name: 'Dependency Review'
on: [pull_request]

permissions:
  contents: read

jobs:
  dependency-review:
    runs-on: ubuntu-latest
    steps:
     - name: 'Checkout Repository'
       uses: actions/checkout@v4

     - name: 'Executar Dependency Review (redirecionado)'
       run: |
         actions/dependency-review-action@v4 > dependency-review-output.txt || true

     - name: 'Salvar Relatório Completo como Artefato'
       uses: actions/upload-artifact@v3
       with:
         name: dependency-review-full-output
         path: dependency-review-output.txt

     - name: 'Adicionar Resumo Filtrado ao Summary'
       run: |
         head -n 100 dependency-review-output.txt > filtered-summary.txt
         echo "### Resumo de Dependências (parcial)" >> $GITHUB_STEP_SUMMARY
         cat filtered-summary.txt >> $GITHUB_STEP_SUMMARY
         echo "Relatório completo disponível como artefato." >> $GITHUB_STEP_SUMMARY

